<%= form_with(model: author, scope: "author", local: true, class: "needs-validation", novalidate: true, data: { controller: "author-form" }) do |form| %>
  <% if author.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(author.errors.count, "error") %> prohibited this author from being saved:</h4>
      <ul>
        <% author.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= form.label :fullname, class: "form-label" %>
    <%= form.text_field :fullname, class: "form-control", required: true %>
    <div class="invalid-feedback">
      Please provide a full name.
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :original_fullname, class: "form-label" %>
    <%= form.text_field :original_fullname, class: "form-control",
        data: { author_form_target: "fullnameInput", action: "input->author-form#syncName" } %>
    <div class="invalid-feedback">
      Please provide a full name.
    </div>
  </div>

  <div class="row mb-3" data-controller="external-link-preview">
    <%= form.label :reference, class: "form-label" %>
    <div class="col-md-2">
      <%= link_to "GOOGLE", "#", target: "_blank",
        data: { author_form_target: "referenceQueryLink", href_scaffold: "http://google.com/search?#{{q: "author wiki NAME"}.to_query}" } %>
    </div>
    <div class="col-md-1"> >> </div>
    <div class="col-md-6">
      <%= form.text_field :reference, class: "form-control",
        data: { action: "input->external-link-preview#syncUrl", external_link_preview_target: "input" } %>
    </div>
    <div class="col-md-1"> >> </div>
    <div class="col-md-2">
      <%= link_to "LINK", nil, target: "_blank", data: { external_link_preview_target: "link" } %>
    </div>
  </div>

  <div class="row mb-3">
    <%= form.label :photo_url, "Author Photo", class: "form-label" %>
    <div class="col-md-2">
      <%= link_to "GOOGLE", "http://google.com/search?#{{tbm: "isch", q: "author photo #{author.fullname}"}.to_query}", target: "_blank",
        data: { author_form_target: "photoQueryLink", href_scaffold: "http://google.com/search?#{{tbm: "isch", q: "author photo NAME"}.to_query}" } %>
    </div>
    <div class="col-md-1"> >> </div>
    <div class="col-md-6">
      <% placeholder = author.photo_url %>
      <% placeholder = placeholder.presence || "Enter the URL for the author's photo" %>
      <%= form.url_field :photo_url, value: nil, class: "form-control", placeholder: placeholder,
        data: { action: "input->external-link-preview#syncUrl" } %>
    </div>
    <div class="col-md-1"> >> </div>
    <div class="col-md-2">
      <%= link_to "LINK", author.photo_url, target: "_blank" %>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <%= form.label :birth_year, class: "form-label" %>
      <%= form.number_field :birth_year, class: "form-control", min: 0, max: Time.current.year %>
    </div>
    <div class="col-md-6">
      <%= form.label :death_year, class: "form-label" %>
      <%= form.number_field :death_year, class: "form-control", min: 0, max: Time.current.year %>
    </div>
  </div>

  <div class="mb-3">
    <%= form.label :cover_type, class: "form-label" %>
    <%= form.select :cover_type, StandardCover::VARIANTS, { include_blank: true }, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= form.submit class: "btn btn-primary" %>
    <%= link_to "Cancel", admin_authors_path, class: "btn btn-secondary" %>
  </div>
<% end %>

<script>
// Bootstrap form validation
(function () {
  'use strict'
  var forms = document.querySelectorAll('.needs-validation')
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
})()
